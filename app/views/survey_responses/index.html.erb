<p id="notice"><%= notice %></p>

<h1>Listing Survey Responses</h1>
<table class="responses">
  <thead>
    <tr>
      <th>Question</th>
      <th colspan="2">Average</th>
      <th colspan="<%= @survey.survey_responses.length %>">
        Individual Responses
      </th>
    </tr>
  </thead>

  <tbody>
    <% analysis = @survey.analyze %>

    <% @survey.survey_template.survey_questions.each do |question| %>
        <% rating = analysis[question] %>
        <tr>
          <td><%= question.title %></td>
          <td><%= mood_img(rating) %></td>
          <td>
            <% unless rating.nil? %>
                <span><%= sprintf('%.2f', rating) %></span>
            <% end %>
          </td>

          <% @survey.survey_responses.each do |response| %>
              <td><%= mood_img(response.answer_for(question).try(:mood)) %></td>
          <% end %>
        </tr>
    <% end %>
  </tbody>
</table>